{"remainingRequest":"/Users/it_calvin/Desktop/my work/demo/node_modules/thread-loader/dist/cjs.js!/Users/it_calvin/Desktop/my work/demo/node_modules/babel-loader/lib/index.js!/Users/it_calvin/Desktop/my work/demo/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/it_calvin/Desktop/my work/demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/it_calvin/Desktop/my work/demo/src/components/pages/Coupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/it_calvin/Desktop/my work/demo/src/components/pages/Coupons.vue","mtime":1653988324368},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgJCBmcm9tICdqcXVlcnknOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkNvdXBvbnMiLAogIHByb3BzOiB7CiAgICBjb25maWc6IE9iamVjdAogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdXBvbnM6IHt9LAogICAgICB0ZW1wQ291cG9uOiB7CiAgICAgICAgdGl0bGU6ICcnLAogICAgICAgIGlzX2VuYWJsZWQ6IDAsCiAgICAgICAgcGVyY2VudDogMTAwLAogICAgICAgIGR1ZV9kYXRlOiAwLAogICAgICAgIGNvZGU6ICcnCiAgICAgIH0sCiAgICAgIGR1ZV9kYXRlOiBuZXcgRGF0ZSgpLAogICAgICBpc05ldzogZmFsc2UKICAgIH07CiAgfSwKICB3YXRjaDogewogICAgZHVlX2RhdGU6IGZ1bmN0aW9uIGR1ZV9kYXRlKCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2YXIgdGltZXN0YW1wID0gTWF0aC5mbG9vcihuZXcgRGF0ZSh2bS5kdWVfZGF0ZSkgLyAxMDAwKTsKICAgICAgdm0udGVtcENvdXBvbi5kdWVfZGF0ZSA9IHRpbWVzdGFtcDsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG9wZW5Db3Vwb25Nb2RhbDogZnVuY3Rpb24gb3BlbkNvdXBvbk1vZGFsKGlzTmV3LCBpdGVtKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgICQoJyNjb3Vwb25Nb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgIHZtLmlzTmV3ID0gaXNOZXc7CgogICAgICBpZiAodm0uaXNOZXcpIHsKICAgICAgICB2bS50ZW1wQ291cG9uID0ge307CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0udGVtcENvdXBvbiA9IE9iamVjdC5hc3NpZ24oe30sIGl0ZW0pOwogICAgICAgIHZhciBkYXRlQW5kVGltZSA9IG5ldyBEYXRlKHZtLnRlbXBDb3Vwb24uZHVlX2RhdGUgKiAxMDAwKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJyk7CiAgICAgICAgdm0uZHVlX2RhdGUgPSBkYXRlQW5kVGltZVswXTsKICAgICAgfQogICAgfSwKICAgIGdldENvdXBvbnM6IGZ1bmN0aW9uIGdldENvdXBvbnMoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHZhciB1cmwgPSAiIi5jb25jYXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9BUElQQVRILCAiL2FwaS8iKS5jb25jYXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9DVVNUT01QQVRILCAiL2FkbWluL2NvdXBvbnMiKTsKICAgICAgdGhpcy4kaHR0cC5nZXQodXJsLCB2bS50ZW1wUHJvZHVjdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2bS5jb3Vwb25zID0gcmVzcG9uc2UuZGF0YS5jb3Vwb25zOwogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlQ291cG9uOiBmdW5jdGlvbiB1cGRhdGVDb3Vwb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgdm0gPSB0aGlzOwoKICAgICAgaWYgKHZtLmlzTmV3KSB7CiAgICAgICAgdmFyIHVybCA9ICIiLmNvbmNhdChwcm9jZXNzLmVudi5WVUVfQVBQX0FQSVBBVEgsICIvYXBpLyIpLmNvbmNhdChwcm9jZXNzLmVudi5WVUVfQVBQX0NVU1RPTVBBVEgsICIvYWRtaW4vY291cG9uIik7CiAgICAgICAgdGhpcy4kaHR0cC5wb3N0KHVybCwgewogICAgICAgICAgZGF0YTogdm0udGVtcENvdXBvbgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSwgdm0udGVtcENvdXBvbik7CiAgICAgICAgICAkKCcjY291cG9uTW9kYWwnKS5tb2RhbCgnaGlkZScpOwoKICAgICAgICAgIF90aGlzLmdldENvdXBvbnMoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgX3VybCA9ICIiLmNvbmNhdChwcm9jZXNzLmVudi5WVUVfQVBQX0FQSVBBVEgsICIvYXBpLyIpLmNvbmNhdChwcm9jZXNzLmVudi5WVUVfQVBQX0NVU1RPTVBBVEgsICIvYWRtaW4vY291cG9uLyIpLmNvbmNhdCh2bS50ZW1wQ291cG9uLmlkKTsKCiAgICAgICAgdm0uZHVlX2RhdGUgPSBuZXcgRGF0ZSh2bS50ZW1wQ291cG9uLmR1ZV9kYXRlICogMTAwMCk7CiAgICAgICAgdGhpcy4kaHR0cC5wdXQoX3VybCwgewogICAgICAgICAgZGF0YTogdm0udGVtcENvdXBvbgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgICAgICAkKCcjY291cG9uTW9kYWwnKS5tb2RhbCgnaGlkZScpOwoKICAgICAgICAgIF90aGlzLmdldENvdXBvbnMoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0Q291cG9ucygpOwogIH0KfTs="},{"version":3,"sources":["Coupons.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div class=\"text-right\">\n      <button class=\"btn btn-primary\" @click=\"openCouponModal(true)\">\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n        <tr>\n          <th>名稱</th>\n          <th>折扣百分比</th>\n          <th>到期日</th>\n          <th>是否啟用</th>\n          <th>編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n          <td>{{ item.title }}</td>\n          <td>{{ item.percent }}%</td>\n          <td>{{ item.due_date | date }}</td>\n          <td>\n            <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\n            <span v-else class=\"text-muted\">未起用</span>\n          </td>\n          <td>\n            <button class=\"btn btn-outline-primary btn-sm\"\n              @click=\"openCouponModal(false, item)\"\n            >編輯</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"modal fade\" id=\"couponModal\" tabindex=\"-1\" role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">Modal title</h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"form-group\">\n              <label for=\"title\">標題</label>\n              <input type=\"text\" class=\"form-control\" id=\"title\" v-model=\"tempCoupon.title\"\n                placeholder=\"請輸入標題\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"coupon_code\">優惠碼</label>\n              <input type=\"text\" class=\"form-control\" id=\"coupon_code\" v-model=\"tempCoupon.code\"\n                placeholder=\"請輸入優惠碼\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"due_date\">到期日</label>\n              <input type=\"date\" class=\"form-control\" id=\"due_date\"\n                v-model=\"due_date\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"price\">折扣百分比</label>\n              <input type=\"number\" class=\"form-control\" id=\"price\"\n                v-model=\"tempCoupon.percent\" placeholder=\"請輸入折扣百分比\">\n            </div>\n            <div class=\"form-group\">\n              <div class=\"form-check\">\n                <input class=\"form-check-input\" type=\"checkbox\"\n                  :true-value=\"1\"\n                  :false-value=\"0\"\n                  v-model=\"tempCoupon.is_enabled\" id=\"is_enabled\">\n                <label class=\"form-check-label\" for=\"is_enabled\">\n                  是否啟用\n                </label>\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n            <button type=\"button\" class=\"btn btn-primary\"\n              @click=\"updateCoupon\">更新優惠券</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport $ from 'jquery';\nexport default {\n  name: \"Coupons\",\n  props: {\n    config: Object,\n  },\n  data() {\n    return {\n      coupons: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        due_date: 0,\n        code: '',\n      },\n      due_date: new Date(),\n      isNew: false,\n    };\n  },\n  watch: {\n    due_date() {\n      const vm = this;\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000);\n      vm.tempCoupon.due_date = timestamp;\n    },\n  },\n  methods: {\n    openCouponModal(isNew, item) {\n      const vm = this;\n      $('#couponModal').modal('show');\n      vm.isNew = isNew;\n      if (vm.isNew) {\n        vm.tempCoupon = {};\n      } else {\n        vm.tempCoupon = Object.assign({}, item);\n        const dateAndTime = new Date(vm.tempCoupon.due_date * 1000).toISOString().split('T');\n        vm.due_date = dateAndTime[0];\n      }\n    },\n    getCoupons() {\n      const vm = this;\n      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons`;\n      this.$http.get(url, vm.tempProduct).then((response) => {\n        vm.coupons = response.data.coupons;\n        console.log(response);\n      });\n    },\n    updateCoupon() {\n      const vm = this;\n      if (vm.isNew) {\n        const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`;\n        this.$http.post(url, { data: vm.tempCoupon }).then((response) => {\n          console.log(response, vm.tempCoupon);\n          $('#couponModal').modal('hide');\n          this.getCoupons();\n        });\n      } else {\n        const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\n        vm.due_date = new Date(vm.tempCoupon.due_date * 1000);\n        this.$http.put(url, { data: vm.tempCoupon }).then((response) => {\n          console.log(response);\n          $('#couponModal').modal('hide');\n          this.getCoupons();\n        });\n      }\n    },\n  },\n  created() {\n    this.getCoupons();\n  },\n};\n</script>\n\n<style scoped>\n\nth, td {\n  text-align: center;\n  }\n\n</style>"],"sourceRoot":"src/components/pages"}]}