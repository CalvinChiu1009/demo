{"remainingRequest":"/Users/it_calvin/Desktop/my work/demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/it_calvin/Desktop/my work/demo/src/components/pages/Coupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/it_calvin/Desktop/my work/demo/src/components/pages/Coupons.vue","mtime":1653988324368},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/it_calvin/Desktop/my work/demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAkIGZyb20gJ2pxdWVyeSc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQ291cG9ucyIsCiAgcHJvcHM6IHsKICAgIGNvbmZpZzogT2JqZWN0LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdXBvbnM6IHt9LAogICAgICB0ZW1wQ291cG9uOiB7CiAgICAgICAgdGl0bGU6ICcnLAogICAgICAgIGlzX2VuYWJsZWQ6IDAsCiAgICAgICAgcGVyY2VudDogMTAwLAogICAgICAgIGR1ZV9kYXRlOiAwLAogICAgICAgIGNvZGU6ICcnLAogICAgICB9LAogICAgICBkdWVfZGF0ZTogbmV3IERhdGUoKSwKICAgICAgaXNOZXc6IGZhbHNlLAogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBkdWVfZGF0ZSgpIHsKICAgICAgY29uc3Qgdm0gPSB0aGlzOwogICAgICBjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKG5ldyBEYXRlKHZtLmR1ZV9kYXRlKSAvIDEwMDApOwogICAgICB2bS50ZW1wQ291cG9uLmR1ZV9kYXRlID0gdGltZXN0YW1wOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIG9wZW5Db3Vwb25Nb2RhbChpc05ldywgaXRlbSkgewogICAgICBjb25zdCB2bSA9IHRoaXM7CiAgICAgICQoJyNjb3Vwb25Nb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgIHZtLmlzTmV3ID0gaXNOZXc7CiAgICAgIGlmICh2bS5pc05ldykgewogICAgICAgIHZtLnRlbXBDb3Vwb24gPSB7fTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS50ZW1wQ291cG9uID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSk7CiAgICAgICAgY29uc3QgZGF0ZUFuZFRpbWUgPSBuZXcgRGF0ZSh2bS50ZW1wQ291cG9uLmR1ZV9kYXRlICogMTAwMCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpOwogICAgICAgIHZtLmR1ZV9kYXRlID0gZGF0ZUFuZFRpbWVbMF07CiAgICAgIH0KICAgIH0sCiAgICBnZXRDb3Vwb25zKCkgewogICAgICBjb25zdCB2bSA9IHRoaXM7CiAgICAgIGNvbnN0IHVybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJUEFUSH0vYXBpLyR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9DVVNUT01QQVRIfS9hZG1pbi9jb3Vwb25zYDsKICAgICAgdGhpcy4kaHR0cC5nZXQodXJsLCB2bS50ZW1wUHJvZHVjdCkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICB2bS5jb3Vwb25zID0gcmVzcG9uc2UuZGF0YS5jb3Vwb25zOwogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlQ291cG9uKCkgewogICAgICBjb25zdCB2bSA9IHRoaXM7CiAgICAgIGlmICh2bS5pc05ldykgewogICAgICAgIGNvbnN0IHVybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJUEFUSH0vYXBpLyR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9DVVNUT01QQVRIfS9hZG1pbi9jb3Vwb25gOwogICAgICAgIHRoaXMuJGh0dHAucG9zdCh1cmwsIHsgZGF0YTogdm0udGVtcENvdXBvbiB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UsIHZtLnRlbXBDb3Vwb24pOwogICAgICAgICAgJCgnI2NvdXBvbk1vZGFsJykubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgIHRoaXMuZ2V0Q291cG9ucygpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHVybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJUEFUSH0vYXBpLyR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9DVVNUT01QQVRIfS9hZG1pbi9jb3Vwb24vJHt2bS50ZW1wQ291cG9uLmlkfWA7CiAgICAgICAgdm0uZHVlX2RhdGUgPSBuZXcgRGF0ZSh2bS50ZW1wQ291cG9uLmR1ZV9kYXRlICogMTAwMCk7CiAgICAgICAgdGhpcy4kaHR0cC5wdXQodXJsLCB7IGRhdGE6IHZtLnRlbXBDb3Vwb24gfSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgICQoJyNjb3Vwb25Nb2RhbCcpLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICB0aGlzLmdldENvdXBvbnMoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldENvdXBvbnMoKTsKICB9LAp9Owo="},{"version":3,"sources":["Coupons.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Coupons.vue","sourceRoot":"src/components/pages","sourcesContent":["<template>\n  <div>\n    <div class=\"text-right\">\n      <button class=\"btn btn-primary\" @click=\"openCouponModal(true)\">\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n        <tr>\n          <th>名稱</th>\n          <th>折扣百分比</th>\n          <th>到期日</th>\n          <th>是否啟用</th>\n          <th>編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n          <td>{{ item.title }}</td>\n          <td>{{ item.percent }}%</td>\n          <td>{{ item.due_date | date }}</td>\n          <td>\n            <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\n            <span v-else class=\"text-muted\">未起用</span>\n          </td>\n          <td>\n            <button class=\"btn btn-outline-primary btn-sm\"\n              @click=\"openCouponModal(false, item)\"\n            >編輯</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"modal fade\" id=\"couponModal\" tabindex=\"-1\" role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 class=\"modal-title\" id=\"exampleModalLabel\">Modal title</h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"form-group\">\n              <label for=\"title\">標題</label>\n              <input type=\"text\" class=\"form-control\" id=\"title\" v-model=\"tempCoupon.title\"\n                placeholder=\"請輸入標題\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"coupon_code\">優惠碼</label>\n              <input type=\"text\" class=\"form-control\" id=\"coupon_code\" v-model=\"tempCoupon.code\"\n                placeholder=\"請輸入優惠碼\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"due_date\">到期日</label>\n              <input type=\"date\" class=\"form-control\" id=\"due_date\"\n                v-model=\"due_date\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"price\">折扣百分比</label>\n              <input type=\"number\" class=\"form-control\" id=\"price\"\n                v-model=\"tempCoupon.percent\" placeholder=\"請輸入折扣百分比\">\n            </div>\n            <div class=\"form-group\">\n              <div class=\"form-check\">\n                <input class=\"form-check-input\" type=\"checkbox\"\n                  :true-value=\"1\"\n                  :false-value=\"0\"\n                  v-model=\"tempCoupon.is_enabled\" id=\"is_enabled\">\n                <label class=\"form-check-label\" for=\"is_enabled\">\n                  是否啟用\n                </label>\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n            <button type=\"button\" class=\"btn btn-primary\"\n              @click=\"updateCoupon\">更新優惠券</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport $ from 'jquery';\nexport default {\n  name: \"Coupons\",\n  props: {\n    config: Object,\n  },\n  data() {\n    return {\n      coupons: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        due_date: 0,\n        code: '',\n      },\n      due_date: new Date(),\n      isNew: false,\n    };\n  },\n  watch: {\n    due_date() {\n      const vm = this;\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000);\n      vm.tempCoupon.due_date = timestamp;\n    },\n  },\n  methods: {\n    openCouponModal(isNew, item) {\n      const vm = this;\n      $('#couponModal').modal('show');\n      vm.isNew = isNew;\n      if (vm.isNew) {\n        vm.tempCoupon = {};\n      } else {\n        vm.tempCoupon = Object.assign({}, item);\n        const dateAndTime = new Date(vm.tempCoupon.due_date * 1000).toISOString().split('T');\n        vm.due_date = dateAndTime[0];\n      }\n    },\n    getCoupons() {\n      const vm = this;\n      const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons`;\n      this.$http.get(url, vm.tempProduct).then((response) => {\n        vm.coupons = response.data.coupons;\n        console.log(response);\n      });\n    },\n    updateCoupon() {\n      const vm = this;\n      if (vm.isNew) {\n        const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`;\n        this.$http.post(url, { data: vm.tempCoupon }).then((response) => {\n          console.log(response, vm.tempCoupon);\n          $('#couponModal').modal('hide');\n          this.getCoupons();\n        });\n      } else {\n        const url = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`;\n        vm.due_date = new Date(vm.tempCoupon.due_date * 1000);\n        this.$http.put(url, { data: vm.tempCoupon }).then((response) => {\n          console.log(response);\n          $('#couponModal').modal('hide');\n          this.getCoupons();\n        });\n      }\n    },\n  },\n  created() {\n    this.getCoupons();\n  },\n};\n</script>\n\n<style scoped>\n\nth, td {\n  text-align: center;\n  }\n\n</style>"]}]}